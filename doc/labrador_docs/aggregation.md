## Step 4 - Aggregation
The aggregation step allows the prover to compress the number of functions it needs to send for verification. The aggregation step in LaBRADOR is divided into two parts. Firstly, one would like to send all the projection functions $\(\langle \sigma_{-1}(\mathbf{\pi_{i}}\^{\(j\)}),\mathbf{\bar{s_{i}}} \rangle -p_{j}\)$ to guarantee that the previously sent projections were computed correctly. Additionally, the prover needs to show that the dot product constraints $f^{'}$, when calculated with $\mathbf{\bar{s_{1}}},\dots,\mathbf{\bar{s_{r}}}$, have zero constant coefficients. Since sending all this information directly would be too costly, the functions are aggregated together by linearly combining them based on uniformly chosen random challenges $\bar{\phi}^{\(k\)} \in (Z_{q})^{L}$ and $\bar{\omega}^{\(k\)} \in (Z_{q})^{256}$ sent by the verifier. So the prover will only have to send $k = 1, \dots , \lceil 128/ log(q) \rceil$ linear combinations of functions. For simplicity, in this section, we will avoid using boldface letters and vector notation when it is clear from the context.

$$f^{''\(k\)}=\sum_{l=1}\^{L}\phi_{l}\^{\(k\)}f^{'\(l)\}(s_{1},\dots,s_{r})+\sum_{j=1}\^{256}\omega_{j}\^{\(k\)}\(<\sigma{-1}(\pi_{i}\^{\(j\)}),s_{i}>-p_{j}\)$$

And based on the fact that the functions $f^{'}$ are of the form $f^{'}(s_{1},\dots,s_{r}) = \sum_{i,j=1}\^{r}a_{ij}\^{'}<s_{i},s_{j}>+\sum_{i=1}\^{r}<\varphi_{i}\^{'},s_{i}>=0$. If we define $a_{ij}\^{''} = \sum_{l=1}\^{L}\phi_{l}\^{\(k\)}a_{ij}\^{\(l\)}$ and $\varphi_{i}\^{''} = \sum_{l=1}\^{L}\phi_{l}\^{\(k\)}\varphi_{i}\^{\(l\)}+\sum_{j=1}\^{256}\omega_{j}\^{\(k\)}\sigma_{-1}(\pi_{i}\^{\(j\)})$ then we can re write the $f^{''}$ functions so that it takes the form of a dot product restriction that becomes zero under $s_{1},\dots,s_{r}$:

$$0=\sum_{i,j=1}\^{r}a_{ij}\^{''}<s_{i},s_{j}>+\sum_{i=1}\^{r}<\varphi_{i}\^{''},s_{i}> - (<\omega^{\(k\)},p> + \sum_{l=1}\^{\(k\)}\phi_{l}\^{\(k\)}b_{0}\^{'\(l\)})$$

So just by sending $\sum_{i,j=1}\^{r}a_{ij}\^{''}<s_{i},s_{j}>+\sum_{i=1}\^{r}<\varphi_{i}\^{''},s_{i}>$ the verifier can check whether the equation holds since its already in position of the other part of the function, therefore only sending that part of the function is enough to verify the condition.

The second part of the aggregation step involves aggregating all the dot product restriction functions together, such that they become zero when applied to $s_1,\dots, s_r$, and the previous functions are combined using linear combinations chosen in a uniform way. In this case, instead of sending these aggregated functions together, their correctness is proven probabilistically using the amortized opening $z$ explained in the amortization step.
